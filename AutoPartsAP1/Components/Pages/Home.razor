@page "/"
@inject ProductoService productoservice
@inject CarritoService carritoservice
@inject NavigationManager navigationmanager
@inject IToastService itoastservice
@rendermode InteractiveServer

<PageTitle>AutoParts</PageTitle>

<header class="bg-white py-3 shadow-sm">
	<div class="container px-4 px-lg-5 my-3">

		<div class="text-center text-dark mt-4">
			<h1 class="display-5 fw-bold">Todo lo que tu vehículo necesita</h1>
			<h6 class="lead text-muted ">Con la mejor calidad-precio</h6>
		</div>
		<a href="#productos">
			<div id="bannerCarousel" class="carousel slide rounded-3 overflow-hidden shadow" data-bs-ride="carousel" data-bs-interval="3500">
				<div class="carousel-inner">
					@if (ListaProductos == null || !ListaProductos.Any())
					{
						<div class="carousel-item active">
							<img src="https://placehold.co/1200x400/dee2e6/6c757d?text=Cargando+Productos..." class="d-block w-100" style="height: 300px; object-fit: cover;" />
						</div>
					}
					else
					{
						@for (int i = 0; i < ListaProductos.Count; i++)
						{
							var producto = ListaProductos[i];
							<div class="carousel-item @(i == 0 ? "active" : "") text-center">
								<img src="@(producto.ProductoImagenUrl ?? "https://placehold.co/1200x400/dee2e6/6c757d?text=No+Imagen+Disponible")"
									 class="text-center w-80 "
									 style="height: 400px; object-fit: cover;"
									 alt="@producto.ProductoNombre" />
							</div>
						}
					}
				</div>
				<button class="carousel-control-prev" type="button" data-bs-target="#bannerCarousel" data-bs-slide="prev">
					<span class="carousel-control-prev-icon"></span>
				</button>
				<button class="carousel-control-next" type="button" data-bs-target="#bannerCarousel" data-bs-slide="next">
					<span class="carousel-control-next-icon"></span>
				</button>
			</div>
		</a>
	</div>
</header>

<section id="productos" class="py-5 bg-light">
	<div class="container px-4 px-lg-5 mt-4">
		<h2 class="fw-bold mb-5 text-center">Nuestros Productos</h2>
		<div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center g-4">
			@if (ListaProductos == null || !ListaProductos.Any())
			{
				<div class="col-12 text-center">
					<p>No hay productos disponibles en este momento.</p>
					<div class="spinner-border text-primary" role="status">
						<span class="visually-hidden">No hay productos disponibles por el momento</span>
					</div>
				</div>
			}
			else
			{
				@foreach (var producto in ListaProductos)
				{
					<div class="col">
						
						<div class="card card-elegant h-100 shadow-sm">
							<a href="/Productos/Detalles/@producto.ProductoId" class="text-decoration-none">
							<div class="position-relative">
								<img src="@(producto.ProductoImagenUrl ?? "https://placehold.co/600x400/dee2e6/6c757d?text=Imagen+No+Disponible")"
									 class="card-img-top"
									 alt="@producto.ProductoNombre" />

								<span class="badge @(producto.ProductoCantidad > 5 ? "bg-success" : "bg-danger") position-absolute top-0 end-0 m-3 shadow">
									@(producto.ProductoCantidad > 0 ? $"Stock: {producto.ProductoCantidad}" : "Agotado")
								</span>
							</div>

							<div class="card-body text-center d-flex flex-column">
								<h5 class="card-title text-dark">@producto.ProductoNombre</h5>

								<span class="badge bg-primary mb-3">@producto.Categoria</span>

								<p class="price mb-2">
									RD$@producto.ProductoMonto.ToString("N2", CultureInfo.GetCultureInfo("es-DO"))
								</p>

								<p class="text-muted flex-grow-1">
									@(producto.ProductoDescripcion?.Length > 80
																? producto.ProductoDescripcion.Substring(0, 80) + "..."
																: producto.ProductoDescripcion)
								</p>
							</div>
						</a>
							<div class="card-footer bg-white border-0 text-center pb-4">
								<button class="btn btn-outline-primary w-100 fw-semibold"
										@onclick="() => AñadirCarrito(producto)"
										disabled="@(producto.ProductoCantidad <= 0)">
									Añadir al carrito
								</button>
							</div>
						</div>
						
					</div>
				}
			}
		</div>
	</div>
</section>

<section id="servicios" class="py-5 bg-dark">
	<div class="container px-4 px-lg-5 text-center">
		<h2 class="fw-bold mb-5 text-white">Nuestros Servicios</h2>

		<img src="https://blog.mecanica.mx/_next/image?url=https%3A%2F%2Fstrapi-mmx.s3.us-east-2.amazonaws.com%2FBlog_5_dfce12da20.png&w=1920&q=100" class="img-fluid rounded shadow text-center col-lg-10" alt="Sobre nosotros" />

		<div class="row g-4 mt-3">
			<div class="col-md-6 col-lg-3">
				<a href="/servicios/detalles" class="text-decoration-none">
					<div class="card h-100 border-0 shadow-sm transition-transform hover-shadow">
						<div class="card-body">
							<i class="bi bi-droplet-half display-4 text-primary mb-3"></i>
							<h5 class="card-title fw-semibold text-black">Lavado de Vehículos</h5>
							<p class="card-text text-muted">Servicio completo de lavado interior y exterior para que tu auto luzca como nuevo.</p>
						</div>
					</div>
				</a>
			</div>
			<div class="col-md-6 col-lg-3">
				<a href="/servicios/detalles" class="text-decoration-none">
					<div class="card h-100 border-0 shadow-sm transition-transform hover-shadow">
						<div class="card-body">
							<i class="bi bi-tools display-4 text-primary mb-3"></i>
							<h5 class="card-title fw-semibold text-black">Reparación</h5>
							<p class="card-text text-muted">Mecánica ligera y diagnósticos rápidos para mantener tu vehículo en óptimas condiciones.</p>
						</div>
					</div>
				</a>
			</div>
			<div class="col-md-6 col-lg-3">
				<a href="/servicios/detalles" class="text-decoration-none">
					<div class="card h-100 border-0 shadow-sm transition-transform hover-shadow">
						<div class="card-body">
							<i class="bi bi-circle-half display-4 text-primary mb-3"></i>
							<h5 class="card-title fw-semibold text-black">Cambio de Gomas</h5>
							<p class="card-text text-muted">Instalación y balanceo de neumáticos nuevos y usados con garantía.</p>
						</div>
					</div>
				</a>
			</div>
			<div class="col-md-6 col-lg-3">
				<a href="/servicios/detalles" class="text-decoration-none">
					<div class="card h-100 border-0 shadow-sm transition-transform hover-shadow">
						<div class="card-body">
							<i class="bi bi-droplet-fill display-4 text-primary mb-3"></i>
							<h5 class="card-title fw-semibold text-black">Cambio de Aceite</h5>
							<p class="card-text text-muted">Aceites certificados y filtros de calidad para prolongar la vida útil de tu motor.</p>
						</div>
					</div>
				</a>
			</div>
		</div>

		<a href="/servicios/detalles" class="btn btn-primary btn-lg mt-5 fw-semibold shadow">
			Ver catágolo de servicios
		</a>
	</div>
</section>

<section id="por-que-elegir" class="py-5">
	<div class="container px-4 px-lg-5">
		<div class="row gx-4 gx-lg-5 align-items-center">

			<div class="col-lg-6">
				<h2 class="fw-bold mb-4">¿Por qué elegir AutoParts?</h2>
				<p class="lead mb-4 text-black">
					En AutoParts, no solo vendemos piezas y ofrecemos servicios, construimos una relación de confianza con cada cliente. Nuestra pasión por los vehículos y el compromiso con la excelencia nos distinguen en el mercado.
				</p>

				<ul class="list-unstyled">
					<li class="d-flex align-items-start mb-3">
						<i class="bi bi-check-circle-fill text-primary me-3 fs-4"></i>
						<div>
							<h5 class="fw-semibold">Calidad Inigualable</h5>
							<p class="mb-0 text-muted">Ofrecemos solo productos de las mejores marcas y repuestos 100% originales, garantizando el máximo rendimiento y la seguridad de tu vehículo.</p>
						</div>
					</li>
					<li class="d-flex align-items-start mb-3">
						<i class="bi bi-gear-wide-connected text-primary me-3 fs-4"></i>
						<div>
							<h5 class="fw-semibold">Servicio Experto</h5>
							<p class="mb-0 text-muted">Contamos con un equipo de técnicos altamente capacitados y con años de experiencia, listos para resolver cualquier problema con precisión y eficiencia.</p>
						</div>
					</li>
					<li class="d-flex align-items-start mb-3">
						<i class="bi bi-truck text-primary me-3 fs-4"></i>
						<div>
							<h5 class="fw-semibold">Responsabilidad y Garantía</h5>
							<p class="mb-0 text-muted">Nuestra responsabilidad es tu tranquilidad. Todos nuestros servicios y productos están respaldados por una garantía sólida, porque confiamos en lo que hacemos.</p>
						</div>
					</li>
					<li class="d-flex align-items-start mb-3">
						<i class="bi bi-person-heart text-primary me-3 fs-4"></i>
						<div>
							<h5 class="fw-semibold">Atención Personalizada</h5>
							<p class="mb-0 text-muted">Te escuchamos y entendemos tus necesidades para ofrecerte la mejor solución. Tu satisfacción es nuestra prioridad.</p>
						</div>
					</li>
				</ul>
			</div>

			<div class="col-lg-6 mt-5 mt-lg-0">
				<img src="https://www.revistaautocrash.com/wp-content/uploads/2016/11/edicion-39/Seguroqs/Seguroquesi.jpg"
					 class="img-fluid rounded shadow"
					 alt="Taller de AutoParts" />
			</div>

		</div>
	</div>
</section>

@code {
	public List<Productos> ListaProductos { get; set; } = new List<Productos>();
	public List<Servicios> ListaServicios { get; set; } = new List<Servicios>();
	private int CarritoConteo = 0;
	private string resultado = "";

	protected override async Task OnInitializedAsync()
	{
		ListaProductos = await productoservice.Listar(c => c.ProductoId > 0 && c.ProductoCantidad>0);
		ActualizarCarrito();
		carritoservice.OnCartChanged += ActualizarCarrito;
	}

	public void Dispose()
	{
		carritoservice.OnCartChanged -= ActualizarCarrito;
	}

	private async Task AñadirCarrito(Productos producto)
	{
		var exito = await carritoservice.AddItemConValidacionAsync(producto.ProductoId, 1);
		if (!exito)
		{
			itoastservice.ShowError("No hay suficiente stock para agregar este producto.");
		}
		else
		{
			itoastservice.ShowSuccess("Producto agregado al carrito.");
		}
	}

	private void ActualizarCarrito()
	{
		CarritoConteo = carritoservice.GetTotalItems();
		StateHasChanged();
	}

	private void NavigateToCart()
	{
		navigationmanager.NavigateTo("/Carrito");
	}

	private void NavigateToAccount()
	{
		navigationmanager.NavigateTo("/Account/Manage");
	}
}